# 11.2 리액트 서버 컴포넌트

## 11.2.1 기존 리액트 컴포넌트와 서버 사이드 렌더링의 한계

**기존 리액트 컴포넌트**

- 컴포넌트는 클라이언트에서 작동하며, 브라우저에서 js 코드를 처리

- 실행에 필요한 코드를 다운로드하고, 트리를 생성한 다음 DOM에 렌더링

**SSR**

- 서버에서 DOM을 만들고, 클라이언트에서 만들어진 DOM을 기준으로 하이드레이션을 진행

**한계점**

- js 번들 크기가 0인 컴포넌트를 만들 수 없다

  클라이언트 브라우저에서 사용하는 라이브러리를 다운로드 뿐 아닌 실행까지 수행

  => 서버 사이드로 수행하면 라이브러리(서버에서 가지고 실행)를 다운로드해 실행하지 않고도 렌더링 가능

- 백엔드 리소스에 대한 직접적인 접근이 불가능하다

  REST API가 아닌 DB에 직접 접근해 원하는 데이터를 가져올 수 있다면 더 이점을 가질 수 있다

- 자동 코드 분할이 불가능하다

  일반적으로 lazy를 사용해 구현했다

  해당 if 문 로직을 판단하기 전까지 어떤 컴포넌트를 가져올 지 결정할 수 없어 지연 로딩으로 인한 성능 이점을 상쇄

  => 만일 클라이언트에 내려 줄 지 서버에서 결정한다면 코드 분할의 이점을 100% 활용

- 연쇄적으로 발생하는 클라이언트와 서버의 요청을 대응하기 어렵다

  부모 컴포넌트의 렌더링이 결정되기 전까지 의존하는 컴포넌트들은 지연

  -> 서버에서 수행하면 클라이언트에서 서버로 요청해 지연을 줄이며 반복적으로 요청을 클라이언트에서 수행할 필요가 X

- 추상화에 드는 비용이 증가한다

  추상화가 복잡해질 수록 코드의 양은 많아지고, 런타임 시에는 오버헤드가 발생

  => 복잡한 추상화에 따른 결과물을 연산하는 작업을 서버에서 수행한다면 클라이언트에서 복잡한 작업을 수행하지 않아도 되므로 속도가 빨라진다

서버 사이드 렌더링과 클라이언트 사이드 렌더링의 장점을 모두 취하고자 하는 것이 **서버 컴포넌트**

## 11.2.2 서버 컴포넌트란?

서버와 클라이언트 모두에서 컴포넌트를 렌더링할 수 있는 기법을 의미

아래는 리액트 컴포넌트 트리를 간단히 도식화한 그림

![image](https://github.com/user-attachments/assets/b04b4800-affc-427e-b675-ed06e41641ce)

**서버 컴포넌트**

- 상태를 가질 수 없으며 렌더링 생명 주기 사용 X

- 브라우저에서 실행되지 않기에 window, document에 접근할 수 X

- 다른 서버 컴포넌트 혹은 클라이언트 컴포넌트를 렌더링 가능

**클라이언트 컴포넌트**

- 서버 컴포넌트를 갖는 구조 가능

- state 나 effect 사용 가능

**공용 컴포넌트**

- 클라이언트와 서버 모두 사용 가능

따라서 리액트에서는 공용 컴포넌트로 판단하지만 use client 를 명시적으로 선언하면 클라이언트 컴포넌트로 판단

## 11.2.3 서버 사이드 렌더링과 서버 컴포넌트의 차이

서버 사이드 렌더링은 서버에서 html 렌더링 한 후 클라이언트에서 하이드레이션 수행

=> 초기 html 로딩된 이후에는 클라이언트에서 js 코드를 다운로드하고 파싱하고 실행하는 데 비용이 든다

서버 사이드 렌더링과 서버 컴포넌트를 모두 채택하게 된다면 서버 사이드 렌더링으로 html을 초기에 빠르게 클라이언트에게 제공하고, 서버 컴포넌트로 부터 js 양 줄일 수 있다

## 11.2.4 서버 컴포넌트는 어떻게 작동하는가?

1. 서버가 렌더링 요청을 받는다.

   서버가 렌더링 과정을 수행해야 하므로 리액트 서버 컴포넌트를 사용하는 모든 페이지는 항상 서버에서 시작

2. 서버는 받은 요청에 따라 컴포넌트를 JSON으로 직렬화한다.

   서버에서 렌더링할 수 있는 것은 직렬화해서 내보내고, 클라이언트 컴포넌트로 표시된 부분은 placeholder 로 비워둔다

   브라우저는 결과물을 받아서 다시 역직렬화한 다음 렌더링

3. 브라우저가 리액트 컴포넌트 트리를 구성한다.

   서버로 스트리밍으로 JSON 결과물을 받았다면 파싱한 결과물을 바탕으로 트리를 재구성해 컴포넌트를 만들어 나간다.

   최종적인 이 트리를 렌더링해 브라우저의 DOM에 커밋

**장점**

- 서버에서 클라이언트로 스트리밍 형태로 보내므로 클라이언트가 줄 단위로 JSON을 일고 렌더링해 사용자에게 빠르기 보여줄 수 있다

- 컴포넌트들이 하나의 번들러 작업에 포함되지 않고 컴포넌트 별개로 돼 있어 컴포넌트를 지연해서 받거나 따로 받기 가능하다

- 결과물이 JSON이므로 리액트 컴포넌트 트리의 구성을 최대한 빠르게 할 수 있도록 한다
