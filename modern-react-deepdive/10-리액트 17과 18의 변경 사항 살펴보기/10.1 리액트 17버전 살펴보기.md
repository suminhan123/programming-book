# 10.1 리액트 17버전 살펴보기

리액트 16과 17 비교 요약

- 새롭게 추가된 기능이 X
- 호환성이 깨지는 변경 사항을 최소화

## 10.1.1 리액트의 점진적인 업그레이드

주 버전이 릴리즈

- 이전 버전의 API 제공을 완전히 중단하고 전체 애플리케이션을 새롭게 업그레이드 하기를 요구

- 오래된 코드 베이스를 기반으로 돌아가는 실제 웹에서 좋지 X

레거시 애플리케이션 개발자는 새로운 버전으로 완전히 넘어가거나, 과거 버전에 머물러야 한다

=> 리액트 17부터는 **점진적인 업그레이드가 가능**

<br />

**실제 예제**

리액트 17 내부에서 리액트 16을 lazy하게 불러온다.

=> 리액트 16을 위한 별도의 루트 요소를 만들고, 리액트 16모듈을 렌더링

## 10.1.2 이벤트 위임 방식의 변경

**리액트에서 어떻게 이벤트를 추가하지**

1. button은 리액트 애플리케이션에서 DOM에 이벤트를 추가하는 방식

   => noop가 이벤트 리스너에 추가

2. button에 직접 DOM을 참조해서 가져온 다음, DOM의 onclick에 직접 함수를 추가하는 고전적인 이벤트 핸들러 추가 방식

   => 직접 정의한 함수가 이벤트 리스너에 추가

<br />

리액트에서 어떻게 이벤트를 처리할까?

이벤트 핸들러를 추가한 각각의 DOM 요소에 부탁 X

이벤트 타입(click, change) 당 하나의 핸들러를 루트에 부탁 : **이벤트 위임**

<br />

이벤트가 어떤 단계로 구성되어있지?

1. 캡처

2. 타깃

3. 버블링

### 이벤트 위임

이벤트 단계의 원리를 활용해 이벤트를 상위 컴포넌트에만 붙이는 것

리액트는 이벤트 핸들러를 각 요소가 아닌 document 에 연결해서 이벤트를 좀 더 효율적으로 관리

이벤트 위임이 리액트 16버전 까지는 모두 document에서 수행

**리액트 17**

리액트 17버전 부터는 이벤트 위임이 모두 document 가 아닌 **리액트 컴포넌트 최상단 트리, 즉 루트 요소**로 바뀌었다

why?

- 점진적인 업그레이드 지원 때문

- 만약 전파를 막으려해도 이미 모든 이벤트는 document에 있어 전파를 막지 X

각 이벤트는 해당 리액트 컴포넌트 트리 수준으로 격리 되므로 이벤트 버블링으로 인한 혼선을 방지

## 10.1.3 import React from 'react'가 더이상 필요없다:새로운 JSX transform

JSX는 브라우저가 이해할 수 있는 코드가 아니므로 JSX를 실행하기 위해 JS로 변환하는 과정이 필요

이런 변환을 위해서 `import React from 'react'` 가 필요

리액트 17부터는 import 구문 없이 JSX 변환이 가능

=> 불필요한 import 구문을 삭제해 번들링 크기를 줄일 수 있다

## 10.1.4 그 밖의 주요 변경 사항

### 이벤트 풀링 제거

SyntheticEvent : 이벤트를 처리하기 위한 이벤트로 브라우저의 기본 이벤트를 한 번 더 감싼 이벤트 객체

이벤트 발생할 때마다 이벤트를 새로 만들어야 하고, 만들때마다 메모리 할당 작업을 수행

=> 해걸 : SyntheticEvent 풀을 만들어서 이벤트가 발생할 때마다 가져오는 것(**이벤트 풀링**)

**단계**

1. 이벤트 핸들러가 이벤트를 발생시킨다.
2. pool에서 SyntheticEvent에 대한 참조를 가져온다.
3. 이벤트 정보를 SyntheticEvent 에 넣어준다.
4. 유저가 지정한 이벤트 리스너가 실행된다.
5. SyntheticEvent 가 null로 초기화되어 pool로 이동한다.

**문제**

- 이벤트 객체를 재사용을 위해 null로 변경하기 때문에 비동기 코드 내부에서 초기화된 null을 얻기 된다.
- 이를 해결하기 위해 e.persist() 를 추가함에 따라 별도의 메모리 공간에 합성 이벤트 객체를 할당해야 한다.

**리액트 17**

따라서 이 이벤트 풀링 개념이 삭제!

### useEffect 클린업 함수의 비동기 실행

useEffect에 있는 클린업 함수는 동기적으로 처리하기

**문제**

클린업 함수가 완료되기 전까지는 다른 작업을 방해하므로 불필요한 성능 저하

**리액트 17**

화면이 완전히 업데이트 된 이후에 클린업 함수가 비동기적으로 실행(컴포넌트 커밋 단계가 완료될 때까지 지연)

### 컴포넌트의 undefined 반환에 대한 일괄적인 처리

컴포넌트 내부에서 undefined를 반환하면 오류가 발생

=> 의도치 않게 잘못된 반환으로 인한 실수를 방지

**문제**

리액트 16에서 forwardRef나 memo에서 undefined 반환하는 경우 에러 반환하지 X

**리액트 17**

16과 달리 모든 경우 에러가 정상적으로 발생

18부터 undefined를 반환해도 에러 발생 X
